# Task ID: 13
# Title: Migrate Sundial demo application to SundialKit v2.0.0 monorepo
# Status: pending
# Dependencies: 1, 2, 3
# Priority: medium
# Description: Import the Sundial iOS/watchOS demo application from the external repository into the SundialKit monorepo using a phased approach. Phase 1: Import with git subtree add and maintain v1.0.0 APIs as validation baseline. Phase 2: Migrate to SundialKit v2.0.0 APIs with SundialKitCombine and SundialKitStream as those plugins complete.
# Details:
Phased migration of Sundial demo application to serve as integration test bed during SundialKit v2.0.0 development:

**Phase 1: Early Import and Validation Baseline (Tasks 1,2,3 dependencies)**

1. Repository Import with git subtree add:
   - Use git subtree add --prefix=Examples/Sundial https://github.com/brightdigit/Sundial.git main to import with full history preservation
   - Maintain original XcodeGen project structure as working baseline
   - Preserve all commits, authors, and timestamps for historical reference
   - Document XcodeGen configuration for reference during SPM migration

2. Validation Baseline Setup:
   - Keep demo on existing v1.0.0 SundialKit APIs initially
   - Ensure demo builds and runs with current SundialKit umbrella package
   - Establish baseline functionality: iPhone ↔ Apple Watch communication, network monitoring, color messaging
   - Create integration test suite to validate core functionality
   - Document current API usage patterns for migration reference

3. Basic Swift Package Manager Integration:
   - Add minimal Package.swift configuration for future SPM targets
   - Configure basic executable products (without full implementation yet)
   - Maintain XcodeGen as primary build system during Phase 1
   - Test both build systems work in parallel

**Phase 2: v2.0.0 API Migration (After Tasks 5,7 complete)**

4. SundialKitCombine Migration:
   - Replace v1.0.0 imports with SundialKitCombine plugin
   - Update NetworkObserver and ConnectivityObserver to use compatibility layer
   - Maintain existing Combine-based architecture with @Published properties
   - Use SundialKitMessagable for color message encoding/decoding
   - Minimal code changes to preserve existing patterns

5. SundialKitStream Implementation:
   - Create modern async/await version using SundialKitStream
   - Replace Combine publishers with AsyncStream APIs
   - Implement actor-based NetworkObserver and ConnectivityObserver
   - Use SundialKitBinary for efficient binary serialization
   - Add proper @MainActor annotations and Swift 6.1 concurrency compliance

6. Shared Components and UI:
   - Extract common SwiftUI views for use by both variants
   - Implement ColorPickerView, ColorDisplayView, NetworkStatusView, ConnectionStatusView
   - Create protocol abstractions to share UI between concurrency models
   - Add error handling and recovery UI components

7. Documentation and Testing:
   - Create comprehensive README with architecture comparison
   - Document migration patterns from v1.0.0 to v2.0.0
   - Add unit and UI tests for both implementations
   - Update CI/CD to build and test demo applications

**Integration Test Benefits:**
- Early validation of core components (Tasks 1,2,3) with real application
- Regression testing during plugin development (Tasks 5,7)
- Demonstration of migration path from v1.0.0 to v2.0.0
- Real-world testing of WatchConnectivity and Network frameworks
- Documentation of best practices for both concurrency models

# Test Strategy:
Phased testing approach matching development phases:

**Phase 1 Testing (Early Import):**
- Git history preservation: Verify all original commits, authors, and timestamps maintained
- Baseline functionality: Demo runs on v1.0.0 APIs without regressions
- Build system compatibility: Both XcodeGen and basic SPM configurations work
- Integration validation: iPhone ↔ Apple Watch communication functions correctly
- Network monitoring: Cellular/wifi/expensive status updates properly
- Color messaging: Color selection and transmission works between devices

**Phase 2 Testing (v2.0.0 Migration):**
- API migration verification: SundialDemoCombine uses compatibility APIs without warnings
- Modern concurrency: SundialDemoStream has zero Swift 6.1 concurrency violations
- Feature parity: Both variants maintain all original demo functionality
- Performance comparison: Binary serialization (Stream) vs dictionary (Combine) efficiency
- UI responsiveness: Smooth updates without dropped frames in both implementations
- Error handling: Proper recovery from connection failures and message send errors

**Continuous Integration:**
- Automated builds for both demo variants on all supported platforms
- Regression testing when core components (Tasks 1,2,3) change
- Progressive testing as plugins (Tasks 5,7) become available
- Documentation accuracy: README instructions successfully guide setup
- Real device testing: Validation on actual iPhone and Apple Watch hardware

# Subtasks:
## 1. Import Sundial repository with git subtree add preserving full history [pending]
### Dependencies: None
### Description: Use git subtree add to import the complete Sundial repository at https://github.com/brightdigit/Sundial into Examples/Sundial/ while preserving all git history, commits, authors, and timestamps for future reference and maintaining historical context
### Details:
Execute git subtree add --prefix=Examples/Sundial https://github.com/brightdigit/Sundial.git main to import the repository with complete history preservation. Verify history import by running git log --oneline --graph Examples/Sundial and git log --follow Examples/Sundial/project.yml to confirm all historical commits are accessible. Analyze the imported structure including iOS app, watchOS app, XcodeGen configuration (project.yml), target definitions, and build settings. Document the current v1.0.0 API usage patterns including NetworkObserver, ConnectivityObserver, and message passing implementation for migration reference

## 2. Establish v1.0.0 API validation baseline [pending]
### Dependencies: 13.1
### Description: Ensure the imported Sundial demo builds and runs correctly with current SundialKit v1.0.0 APIs, creating a validation baseline for regression testing during v2.0.0 development
### Details:
Verify the imported demo application builds and runs with existing SundialKit umbrella package using XcodeGen. Test core functionality: iPhone app launching and displaying network status, Apple Watch app showing connectivity state, color selection transmission between devices, reachability status updates, and network state changes reflection in UI. Document current API usage patterns including import statements, observer instantiation, publisher subscriptions, and message handling. Create integration test checklist for validating functionality after core component changes. Establish performance baseline measurements for comparison during v2.0.0 migration

## 3. Add basic Package.swift configuration for future SPM migration [pending]
### Dependencies: 13.2
### Description: Update the root Package.swift to include basic executable product and target definitions for the Sundial demo, preparing for eventual Swift Package Manager migration while maintaining XcodeGen as the primary build system
### Details:
Add executable product definition to root Package.swift: .executable(name: "SundialDemo", targets: ["SundialDemo"]). Define corresponding target with dependency on SundialKit umbrella package and proper source path pointing to Examples/Sundial/. Set deployment targets to match existing iOS 14.8+ and watchOS 7.4+ requirements. Configure basic resource handling for assets and localization files. Ensure both XcodeGen and SPM build systems can coexist without conflicts. Test that swift build works for basic compilation while XcodeGen remains the primary development environment

## 4. Create integration test suite for baseline functionality [pending]
### Dependencies: 13.3
### Description: Develop comprehensive integration tests for the imported demo to validate core SundialKit functionality and serve as regression tests during v2.0.0 development
### Details:
Create Tests/SundialDemoTests/ directory with integration test suite covering: network monitoring state changes, WatchConnectivity session activation and reachability, message encoding/decoding for color data, UI state updates in response to connectivity changes, error handling for connection failures, and cross-platform communication flows. Use existing SundialKit test patterns and Mock* implementations where appropriate. Configure test targets in both Package.swift and XcodeGen project for parallel test execution. Include performance benchmarks for message latency and UI responsiveness to establish baseline measurements for v2.0.0 comparison

## 5. Document current v1.0.0 API patterns and migration roadmap [pending]
### Dependencies: 13.4
### Description: Create comprehensive documentation of the current demo implementation using v1.0.0 APIs and establish clear migration roadmap for Phase 2 v2.0.0 transition
### Details:
Create Examples/Sundial/BASELINE.md documenting current v1.0.0 implementation including: import statements and dependency structure, NetworkObserver and ConnectivityObserver usage patterns, Combine publisher chains and @Published property subscriptions, message encoding/decoding with ColorMessage, error handling approaches, and UI update mechanisms. Document XcodeGen configuration details including project.yml structure, target definitions, and build settings. Create MIGRATION.md outlining Phase 2 roadmap: SundialKitCombine compatibility migration steps, SundialKitStream modern async/await conversion, timeline dependencies on Tasks 5 and 7 completion, testing strategy for ensuring feature parity, and success criteria for each migration phase

## 6. Setup CI/CD for demo integration testing [pending]
### Dependencies: 13.5
### Description: Configure GitHub Actions workflows to build and test the imported demo application, providing continuous validation during core component development
### Details:
Update .github/workflows/ci.yml to include Sundial demo build verification using both XcodeGen and SPM. Add specific job matrix for demo testing across iOS 14.8+ and watchOS 7.4+ platforms. Configure integration test execution in CI environment with proper simulator setup. Add demo build status checks as required GitHub Actions for pull requests affecting core components (Tasks 1,2,3). Include performance regression detection by comparing benchmark results against baseline measurements. Configure build artifact collection for demo applications to enable manual testing on devices

## 7. Validate demo serves as effective integration test bed [pending]
### Dependencies: 13.6
### Description: Verify the imported demo application effectively validates core SundialKit functionality and provides meaningful regression testing during ongoing v2.0.0 development
### Details:
Test demo's effectiveness as integration test bed by simulating core component changes and verifying regression detection. Validate demo catches breaking changes in Tasks 1,2,3 components through automated testing. Confirm demo provides meaningful feedback for NetworkMonitor and ConnectivityManager development. Test demo's ability to validate real-world usage patterns including network state transitions, WatchConnectivity session lifecycle, message transmission reliability, and UI responsiveness. Document integration feedback loop for core component developers including test failure interpretation, debugging guidance, and performance impact assessment

